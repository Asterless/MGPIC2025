# Asterless/MGPIC2025(合成猫Meme)

这是一个基于流行的“合成大西瓜”玩法的简单合并游戏，使用 [MoonBit](https://www.moonbitlang.com/) 语言和 [Selene](https://github.com/moonbitlang/selene) 游戏引擎构建。

## 游戏玩法

- 从屏幕顶部落下不同等级的猫Meme。
- 当两只相同等级的猫Meme相遇时，它们会合并成一只更高等级的猫Meme，并获得分数。
- 当不同等级的猫Meme相遇时，它们会发生物理碰撞。
- 游戏的目标是尽可能多地合并猫Meme，获得更高的分数，并防止猫Meme堆满整个屏幕。

## 操作指南

- **A / D**: 左右移动指针。
- **空格 (Space)**: 从当前指针位置落下猫Meme。
- **Q / E**: 对屏幕上所有的猫Meme施加一个水平方向的力。
- **鼠标左键点击猫Meme**: 猫Meme会发出可爱的叫声！

## TODO 列表

这是一个未来可以添加或改进的功能列表：

- [ ] **游戏结束逻辑**: 实现当猫Meme堆积超过顶部警戒线时游戏结束的机制(非必选)。
- [ ] **完善 UI**:
  - [ ] 设计一个更好看的得分和“下一个猫Meme”的展示界面。
  - [ ] 添加一个清晰的游戏结束画面，显示最终得分和重玩按钮。
- [ ] **更丰富的音效**:
  - [x] 为不同等级的猫Meme添加独特的点击音效。
  - [ ] 添加游戏结束的音效。
- [ ] **视觉效果**:
  - [ ] 为猫Meme合并时添加粒子效果或动画，使其更具视觉冲击力。
  - [ ] 为背景添加动态效果。
- [ ] **游戏平衡性**:
  - [ ] 调整随机生成猫Meme等级的权重，以优化游戏节奏。
  - [ ] 调整猫Meme的物理参数（如弹力、摩擦力）。
- [ ] **高分榜**: 实现一个本地或在线的高分榜，记录玩家的最佳成绩。
- [x] **代码重构**: 将 `main.mbt` 中庞大的代码拆分到不同的模块中，以提高可维护性（例如，`state.mbt`, `systems.mbt`）。
- [ ] **函数式重构**:
  - [ ] 使用Monad来隔离副作用，提升游戏状态管理的可读性。
  - [ ] 将带副作用的函数里的计算部分提取为纯函数
  - [ ] 尽可能消除可变性
  - [ ] 尽可能使用`each()`，`map()`和`folder()`，减少for循环的使用
- [ ] **插件系统**:
  - [ ] 创建一个插件接口，通过插件接口的标准化操作来将游戏玩法模块化
  - [ ] 将目前的核心玩法提取为一个core插件
- [ ] **更好的碰撞箱引擎**:
  - [ ] 基于圆形碰撞箱重新设计一个碰撞箱引擎，并修复原生碰撞箱下的挤压bug


## 设计说明

本项目充分利用了 MoonBit 的函数式编程特性，构建了一个类型安全、可组合且易于维护的游戏架构。

项目大量使用高阶函数，实现了高度的抽象和代码复用：

- **事件绑定系统**: `bind_key` 和 `bind_keys` 接受函数作为参数（`handler : () -> Unit`），实现了事件处理逻辑的执行和组合
- **迭代器模式**: 使用 `cats_by_entity.each()`，`map()`和`fold()`等高阶函数进行集合操作，避免了命令式的循环和可变状态
